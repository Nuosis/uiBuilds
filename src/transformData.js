const custObj = {
	"fieldData" : 
	{
		"Client_Type" : "Customer",
		"Company" : "Cridge Centre for the Family",
		"Last_Name_Initial" : "C",
		"Name" : "Cridge Centre for the Family",
		"RESTfmDeleteFlag" : "",
		"__ID" : "0F783A28-FC8E-41DB-B01E-A76918F53C7D",
		"_orgID" : "6FF320DD-757B-42BB-ACD5-00BFCD5F58E0",
		"first_name" : "Jen",
		"last_name" : "Braun"
	},
	"modId" : "13",
	"portalData" : 
	{
		"Customer Tasks" : 
		[
			{
				"Customer Tasks::Date_Completed" : "08/14/2023",
				"Customer Tasks::Date_Due" : "08/05/2023",
				"Customer Tasks::Item" : "Follow Up on Quote",
				"Customer Tasks::Status" : "Closed",
				"Customer Tasks::__ID" : "59D75867-1775-4C4F-B640-1886DA833536",
				"modId" : "2",
				"recordId" : "21228"
			}
		],
		"customerContacts" : 
		[
			{
				"customerContacts::Name_of_Relation" : "Jen Braun",
				"customerContacts::Role" : "Primary Contact",
				"customerContacts::__ID" : "C4ABA376-7507-479F-AC24-4BB4A2746B72",
				"modId" : "0",
				"recordId" : "2932"
			}
		],
		"customerWorkOrders" : 
		[
			{
				"customerWorkOrders::Select" : 0,
				"customerWorkOrders::WorkOrder Name" : "Pre opening clean",
				"customerWorkOrders::__ID" : "0FDE4A9F-E619-4BC5-A117-4AB81CA57B93",
				"customerWorkOrders::_cleanerID" : "3A3FBDA3-5970-47C8-831F-DD90533B1E0F",
				"customerWorkOrders::_orgID" : "6FF320DD-757B-42BB-ACD5-00BFCD5F58E0",
				"customerWorkOrders::_providerID" : "558E8EED-4AD7-465D-BFA2-9FCC5225C7F2",
				"modId" : "16",
				"recordId" : "9382"
			}
		],
		"customerWorksheets" : 
		[
			{
				"customerWorksheets::Select" : "1",
				"customerWorksheets::Worksheet Name" : "Apartment common area",
				"customerWorksheets::__ID" : "8B68B0D5-7AC5-4AAC-B7E9-BEA537BC74C9",
				"customerWorksheets::_cleanerID" : "",
				"customerWorksheets::_orgID" : "6FF320DD-757B-42BB-ACD5-00BFCD5F58E0",
				"customerWorksheets::_providerID" : "558E8EED-4AD7-465D-BFA2-9FCC5225C7F2",
				"modId" : "18",
				"recordId" : "1938"
			},
			{
				"customerWorksheets::Select" : "1",
				"customerWorksheets::Worksheet Name" : "Office space",
				"customerWorksheets::__ID" : "8098309C-30F8-418B-B893-3D3A06145339",
				"customerWorksheets::_cleanerID" : "3A3FBDA3-5970-47C8-831F-DD90533B1E0F",
				"customerWorksheets::_orgID" : "6FF320DD-757B-42BB-ACD5-00BFCD5F58E0",
				"customerWorksheets::_providerID" : "558E8EED-4AD7-465D-BFA2-9FCC5225C7F2",
				"modId" : "15",
				"recordId" : "1939"
			}
		],
		"customersAddress" : 
		[
			{
				"customersAddress::Address" : "919 Caledonia Ave",
				"customersAddress::City" : "Victoria",
				"customersAddress::Passcode" : "",
				"customersAddress::Postal_Code" : "",
				"customersAddress::Prov" : "BC",
				"customersAddress::__ID" : "F5B9E11C-904C-45DF-9A5D-760D5727CB2F",
				"customersAddress::addressTYPE" : "",
				"customersAddress::geoLat" : "48.4305696",
				"customersAddress::geoLong" : "-123.3575658",
				"modId" : "1",
				"recordId" : "7898"
			}
		],
		"customersEmail" : 
		[
			{
				"customersEmail::Email" : "jbraun@cridge.org",
				"customersEmail::Label" : "main",
				"customersEmail::__ID" : "51E7B6A4-1D75-4FB3-A87C-4ABE72401232",
				"modId" : "0",
				"recordId" : "5588"
			}
		],
		"customersPhone" : 
		[
			{
				"customersPhone::Extension" : "",
				"customersPhone::Label" : "Main",
				"customersPhone::Number" : "(250) 986-7543",
				"customersPhone::__ID" : "302542F4-2C50-4993-B1CF-A782C9A063FB",
				"modId" : "0",
				"recordId" : "9523"
			}
		]
	},
	"portalDataInfo" : 
	[
		{
			"database" : "Clean Sweep",
			"foundCount" : 2,
			"portalObjectName" : "customerWorksheets",
			"returnedCount" : 2,
			"table" : "customerWorksheets"
		},
		{
			"database" : "Clean Sweep",
			"foundCount" : 1,
			"portalObjectName" : "customerWorkOrders",
			"returnedCount" : 1,
			"table" : "customerWorkOrders"
		},
		{
			"database" : "Clean Sweep",
			"foundCount" : 1,
			"returnedCount" : 1,
			"table" : "customersAddress"
		},
		{
			"database" : "Clean Sweep",
			"foundCount" : 1,
			"returnedCount" : 1,
			"table" : "customersEmail"
		},
		{
			"database" : "Clean Sweep",
			"foundCount" : 1,
			"returnedCount" : 1,
			"table" : "customersPhone"
		},
		{
			"database" : "Clean Sweep",
			"foundCount" : 1,
			"returnedCount" : 1,
			"table" : "Customer Tasks"
		},
		{
			"database" : "Clean Sweep",
			"foundCount" : 1,
			"returnedCount" : 1,
			"table" : "customerContacts"
		}
	],
	"recordId" : "1831"
};

const wsArray = [
	{
		"fieldData" : 
		{
			"Cleaner" : "Cassandra Paris",
			"Cleaner Assigned Date" : "09/08/2023",
			"End Date" : "",
			"FSA Value" : 158.3,
			"Relief Cleaner" : "",
			"SCSA Value" : 197.87,
			"Select" : "1",
			"Start Date" : "09/08/2023",
			"Worksheet Name" : "Apartment common area",
			"__ID" : "8B68B0D5-7AC5-4AAC-B7E9-BEA537BC74C9",
			"_cleanerID" : "",
			"_custID" : "0F783A28-FC8E-41DB-B01E-A76918F53C7D",
			"_orgID" : "6FF320DD-757B-42BB-ACD5-00BFCD5F58E0",
			"_providerID" : "558E8EED-4AD7-465D-BFA2-9FCC5225C7F2",
			"_siteType" : "Condominium",
			"cleaner RATE" : "?",
			"f_reliefCleaner" : "",
			"provider" : "Preferred Work Force Management Services",
			"providerAssignedDate" : "07/28/2023",
			"reliefEndDate" : "",
			"reliefStartDate" : "",
			"saved AMOUNT LABOUR" : 315.97,
			"saved AMOUNT TOTAL" : 315.972222222222,
			"saved AMOUNT TOTAL PROVIDER" : 0,
			"saved TIME" : 9.02777777777778,
			"saved TPC" : 125,
			"suspended" : "",
			"suspendedDate" : "",
			"suspendedDateEnd" : ""
		},
		"modId" : "18",
		"portalData" : 
		{
			"workSheet_WorksheetInfo" : 
			[
				{
					"modId" : "23",
					"recordId" : "79484",
					"workSheet_WorksheetInfo::Area" : "Elevator",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 10,
					"workSheet_WorksheetInfo::__ID" : "CA92D1FB-5541-45C5-B791-86B18A69AB3C",
					"workSheet_WorksheetInfo::~order" : 2
				},
				{
					"modId" : "25",
					"recordId" : "79485",
					"workSheet_WorksheetInfo::Area" : "Entry",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 5,
					"workSheet_WorksheetInfo::__ID" : "23F61AAF-856D-48B6-A30B-01E2D7B38ECC",
					"workSheet_WorksheetInfo::~order" : 1
				},
				{
					"modId" : "25",
					"recordId" : "79486",
					"workSheet_WorksheetInfo::Area" : "Garbage Area",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 10,
					"workSheet_WorksheetInfo::__ID" : "E46826F3-10F0-4DF0-AFED-15ED65B2E436",
					"workSheet_WorksheetInfo::~order" : 6
				},
				{
					"modId" : "24",
					"recordId" : "79487",
					"workSheet_WorksheetInfo::Area" : "Hallway",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 60,
					"workSheet_WorksheetInfo::__ID" : "070DDBD2-1E6E-45CB-A6CE-C54CCAB9CADB",
					"workSheet_WorksheetInfo::~order" : 4
				},
				{
					"modId" : "25",
					"recordId" : "79488",
					"workSheet_WorksheetInfo::Area" : "Lobby",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 5,
					"workSheet_WorksheetInfo::__ID" : "52AFD6DF-6F0B-47A4-B9E3-4116EC359B89",
					"workSheet_WorksheetInfo::~order" : 3
				},
				{
					"modId" : "26",
					"recordId" : "79489",
					"workSheet_WorksheetInfo::Area" : "Parkade",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 5,
					"workSheet_WorksheetInfo::__ID" : "0A9E1F12-60A8-4A9E-B59C-F9076F25FDE9",
					"workSheet_WorksheetInfo::~order" : 7
				},
				{
					"modId" : "25",
					"recordId" : "79490",
					"workSheet_WorksheetInfo::Area" : "Stairwell and Landings",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 30,
					"workSheet_WorksheetInfo::__ID" : "5CB2F357-40D8-4874-B462-408D6A418C7D",
					"workSheet_WorksheetInfo::~order" : 5
				}
			]
		},
		"portalDataInfo" : 
		[
			{
				"database" : "Clean Sweep",
				"foundCount" : 7,
				"returnedCount" : 7,
				"table" : "workSheet_WorksheetInfo"
			}
		],
		"recordId" : "1938"
	},
	{
		"fieldData" : 
		{
			"Cleaner" : "Cassandra Paris",
			"Cleaner Assigned Date" : "09/08/2023",
			"End Date" : "",
			"FSA Value" : 75.98,
			"Relief Cleaner" : "",
			"SCSA Value" : 94.98,
			"Select" : "1",
			"Start Date" : "09/08/2023",
			"Worksheet Name" : "Office space",
			"__ID" : "8098309C-30F8-418B-B893-3D3A06145339",
			"_cleanerID" : "3A3FBDA3-5970-47C8-831F-DD90533B1E0F",
			"_custID" : "0F783A28-FC8E-41DB-B01E-A76918F53C7D",
			"_orgID" : "6FF320DD-757B-42BB-ACD5-00BFCD5F58E0",
			"_providerID" : "558E8EED-4AD7-465D-BFA2-9FCC5225C7F2",
			"_siteType" : "Offices SqrFt",
			"cleaner RATE" : 0.75,
			"f_reliefCleaner" : "",
			"provider" : "Preferred Work Force Management Services",
			"providerAssignedDate" : "07/28/2023",
			"reliefEndDate" : "",
			"reliefStartDate" : "",
			"saved AMOUNT LABOUR" : 151.67,
			"saved AMOUNT TOTAL" : 151.666666666667,
			"saved AMOUNT TOTAL PROVIDER" : 126.64,
			"saved TIME" : 4.33333333333333,
			"saved TPC" : 60,
			"suspended" : "",
			"suspendedDate" : "",
			"suspendedDateEnd" : ""
		},
		"modId" : "15",
		"portalData" : 
		{
			"workSheet_WorksheetInfo" : 
			[
				{
					"modId" : "40",
					"recordId" : "79492",
					"workSheet_WorksheetInfo::Area" : "Throughout",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 30,
					"workSheet_WorksheetInfo::__ID" : "3A87DFF0-52DE-467C-8254-CEC96C40EDB4",
					"workSheet_WorksheetInfo::~order" : 1
				},
				{
					"modId" : "22",
					"recordId" : "79493",
					"workSheet_WorksheetInfo::Area" : "Washroom",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 15,
					"workSheet_WorksheetInfo::__ID" : "355AD8AD-BC56-4469-BD5E-7A79CADB9290",
					"workSheet_WorksheetInfo::~order" : 2
				},
				{
					"modId" : "23",
					"recordId" : "79494",
					"workSheet_WorksheetInfo::Area" : "Kitchen",
					"workSheet_WorksheetInfo::Frequency Specified Horozontal" : "Weekly: Friday",
					"workSheet_WorksheetInfo::Rate" : 35,
					"workSheet_WorksheetInfo::Total Time Per Visit" : 15,
					"workSheet_WorksheetInfo::__ID" : "3D9C8601-5281-4560-B797-EB380B6844F9",
					"workSheet_WorksheetInfo::~order" : 3
				}
			]
		},
		"portalDataInfo" : 
		[
			{
				"database" : "Clean Sweep",
				"foundCount" : 3,
				"returnedCount" : 3,
				"table" : "workSheet_WorksheetInfo"
			}
		],
		"recordId" : "1939"
	}
]

const currentState = {org: "6FF320DD-757B-42BB-ACD5-00BFCD5F58E0"}

export default function transformData(custObj, currentState, wsArray, selectedWorksheetID) {
	// console.log("custObj", custObj)
	// console.log("wsArray", wsArray)
	// console.log("selectedWS", selectedWorksheetID)
	const newObj = {};
	
	// Emails Array
	newObj.emails = custObj.portalData.customersEmail.map((email) => ({
	label: email['customersEmail::Label'],
	address: email['customersEmail::Email'],
	ID: email['customersEmail::__ID'],
	}));
	// console.log("emailsArray",newObj)

	// People Array
	newObj.people = custObj.portalData.customerContacts.map((contact) => ({
	name: contact['customerContacts::Name_of_Relation'],
	role: contact['customerContacts::Role'],
	ID: contact['customerContacts::__ID'],
	}));
	// console.log("PeopleArray",newObj)

	// Phones Array
	newObj.phones = custObj.portalData.customersPhone.map((phone) => ({
	label: phone['customersPhone::Label'],
	number: phone['customersPhone::Number'],
	ID: phone['customersPhone::__ID'],
	}));

	// console.log("phoneArray",newObj)

	// Navigation Array
	newObj.navigation = [
	{
		name: 'Worksheets',
		href: '#',
		current: true,
		ID: 1,
	},
	{
		name: 'Active',
		current: false,
		ID: 2,
		children: custObj.portalData.customerWorksheets
		.filter((worksheet) => worksheet['customerWorksheets::Select'] === "1")
		.map((worksheet) => ({
			name: worksheet['customerWorksheets::Worksheet Name'],
			ID: worksheet['customerWorksheets::__ID'],
			href: '#',
		})),
	},
	{
		name: 'Inactive',
		current: false,
		ID: 3,
		children: custObj.portalData.customerWorksheets
		.filter((worksheet) => worksheet['customerWorksheets::Select'] !== "1")
		.map((worksheet) => ({
			name: worksheet['customerWorksheets::Worksheet Name'],
			ID: worksheet['customerWorksheets::__ID'],
			href: '#',
		})),
	},
	];
	// console.log("navigation",newObj.navigation)

	const selectedWorksheet = custObj.portalData.customerWorksheets.find(
	(worksheet) => worksheet['customerWorksheets::__ID'] === selectedWorksheetID
	);
	const matchingWsArray = wsArray.find(
	(fieldData) => fieldData.fieldData['__ID'] === selectedWorksheetID
	);
	// console.log("matchingWsArray",matchingWsArray)

	// Worksheet Object
	newObj.worksheet = {
	ID: selectedWorksheet['customerWorksheets::__ID'],
	org: currentState.org,
	contractOrg: selectedWorksheet['customerWorksheets::_orgID'],
	name: selectedWorksheet['customerWorksheets::Worksheet Name'],
	startDate: matchingWsArray.fieldData['Start Date'],
	endDate: matchingWsArray.fieldData['End Date'],
	provider: matchingWsArray.fieldData['provider'],
	providerStartDate: matchingWsArray.fieldData['providerAssignedDate'],
	providerID: matchingWsArray.fieldData['_providerID'],
	cleaner: matchingWsArray.fieldData['Cleaner'],
	cleanerStartDate: matchingWsArray.fieldData['Cleaner Assigned Date'],
	cleanerID: matchingWsArray.fieldData['_cleanerID'],
	contractValue: matchingWsArray.fieldData["saved AMOUNT TOTAL"],
	providerValue: matchingWsArray.fieldData["saved AMOUNT TOTAL PROVIDER"],
	cleanerValue: matchingWsArray.fieldData["SCSA Value"],
	};
	// console.log("worksheetObj",newObj.worksheet)

	// WorksheetRecords Array
	newObj.worksheetRecords = matchingWsArray.portalData.workSheet_WorksheetInfo
	.sort((a, b) => a['workSheet_WorksheetInfo::~order'] - b['workSheet_WorksheetInfo::~order'])
	.map((record) => ({
		area: record['workSheet_WorksheetInfo::Area'],
		frequency: record['workSheet_WorksheetInfo::Frequency Specified Horozontal'],
		rate: record['workSheet_WorksheetInfo::Rate'],
		eot: record['workSheet_WorksheetInfo::Total Time Per Visit'],
		ID: record['workSheet_WorksheetInfo::__ID'],
	}));
	// console.log("recordsArray",newObj)

	// CONSTRUCT TOTALTIME
	// Initialize an empty object to hold the subtotals based on frequency
	const totalTime = {};
	// Calculate the sum of eot based on frequency
	newObj.worksheetRecords.reduce((acc, record) => {
		const frequency = record.frequency;  // Extract frequency from the current record
		const eotValue = parseFloat(record.eot);  // Extract and convert eot to a floating-point number
		
		// Initialize frequency in acc if it doesn't already exist
		if (!acc[frequency]) {
			acc[frequency] = 0;
		}
		
		// Add the eot value to the running total for this frequency
		acc[frequency] += eotValue;
		
		return acc;  // Return updated acc for the next iteration
	}, totalTime);

	// Add the totalTime object to newObj.worksheet
	newObj.worksheet.totalTime = totalTime;

	// Get the first record from the worksheetRecords array
	const firstRecord = newObj.worksheetRecords[0];

	// Initialize an empty object for firstRecordTotalTime
	let firstRecordTotalTime = {};

	// Extract the total time from totalTime for the key with the same value as firstRecord.frequency
	if (firstRecord && newObj.worksheet.totalTime && newObj.worksheet.totalTime.hasOwnProperty(firstRecord.frequency)) {
	firstRecordTotalTime = newObj.worksheet.totalTime[firstRecord.frequency];
	}

	// Set totalTime.default to firstRecordTotalTime
	newObj.worksheet.totalTime.default = firstRecordTotalTime;
	// console.log("worksheetObj",newObj.worksheet)

	// Check if totalTime has only two keys
	//if (newObj.worksheet.totalTime && Object.keys(newObj.worksheet.totalTime).length === 2) {
		// Remove the key that matches firstRecord.frequency
		//delete newObj.worksheet.totalTime[firstRecord.frequency];
	//}
	return newObj;
}
